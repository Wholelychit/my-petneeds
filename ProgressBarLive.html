<!DOCTYPE html>
<html>
  <head>
    <style>
      body { font-family: sans-serif; text-align: center; padding: 20px; }
      #bar-container { width: 100%; background-color: #f1f1f1; border-radius: 10px; margin-top: 20px; }
      #bar { width: 0%; height: 20px; background-color: #4CAF50; border-radius: 10px; transition: width 0.2s; }
      #cancelBtn { margin-top: 15px; padding: 5px 15px; font-size: 14px; }
    </style>
  </head>
  <body>
    <h3 id="status">Starting...</h3>
    <div id="bar-container"><div id="bar"></div></div>
    <button id="cancelBtn" onclick="cancelProcessing()">Cancel</button>

    <script>
      function updateProgress(current, total) {
        document.getElementById("status").innerText = `Processing: ${current} of ${total}`;
        document.getElementById("bar").style.width = (current / total * 100) + "%";
        if (current === total) {
          setTimeout(() => google.script.host.close(), 1500);
        }
      }

      function cancelProcessing() {
        document.getElementById("status").innerText = "Cancelling...";
        google.script.run.setCancelFlag(); // Tell Apps Script to stop immediately
      }
    </script>
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <style>
      body { font-family: sans-serif; text-align: center; padding: 20px; }
      #bar-container { width: 100%; background-color: #f1f1f1; border-radius: 10px; margin-top: 20px; }
      #bar { width: 0%; height: 20px; background-color: #4CAF50; border-radius: 10px; transition: width 0.1s; }
      #cancelBtn { margin-top: 15px; padding: 5px 15px; font-size: 14px; }
    </style>
  </head>
  <body>
    <h3 id="status">Starting...</h3>
    <div id="bar-container"><div id="bar"></div></div>
    <button id="cancelBtn" onclick="cancelProcessing()">Cancel</button>

    <script>
      function updateProgress(current, total) {
        document.getElementById("status").innerText = `Processing: ${current} of ${total}`;
        document.getElementById("bar").style.width = (current / total * 100) + "%";
        if (current === total) setTimeout(() => google.script.host.close(), 1000);
      }

      function cancelProcessing() {
        document.getElementById("status").innerText = "Cancelling...";
        google.script.run.setCancelFlag();
      }

      // Start bulk processing immediately when the dialog loads
      google.script.run.withSuccessHandler(function(){})
        .startBulkProcess();
    </script>
  </body>
</html>

